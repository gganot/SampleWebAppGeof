on: [push]

name: AzureLoginSample

jobs:

  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Deploy Sql
      run: env
    - uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}
    - uses: Azure/sql-action@v1
      with:  
        server-name: 'tcp:geofreyganot.database.windows.net,1433'  
        connection-string: 'Server=tcp:geofreyganot.database.windows.net,1433;Initial Catalog=SampleDatabaseForDeployment;Persist Security Info=False;User ID=geofreyganot;Password=Geofrey@123;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;'
        sql-file: ${{env.GITHUB_WORKSPACE}}/sql-script.sql
    - run: |
        az webapp list --query "[?state=='Running']"
